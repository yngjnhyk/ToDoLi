<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
      rel="stylesheet"
    />
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <title>ğŸ¸ TO-DO-LI ğŸ¸</title>
    <meta property="og:title" content="16ê¸° 15ì¡° : ì›¹ë¯¸ë‹ˆí”„ë¡œì íŠ¸" />
    <meta property="og:description" content="ğŸ¸TO-DO-LIğŸ¸" />
    <meta property="og:image" content="" />

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Gaegu&display=swap');

      * {
        font-family: 'Gaegu', cursive;
      }

      body,
      h1,
      h2,
      h3,
      h4,
      p,
      div,
      a {
        margin: 0px;
        padding: 0px;
        text-decoration: none;
        font-weight: normal;
      }

      body {
        background-color: #f0fff0;
      }

      .box {
        margin: auto;

        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

        width: 1200px;
      }

      /* ìƒë‹¨ ë°•ìŠ¤  */

      .topbox {
        /* background-color: rebeccapurple; */
        height: 150px;
        width: 85%;
        margin: auto;
        padding: 0px 40px;

        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .currentWeather {
        font-size: 28px;
      }

      .title {
        font-size: 35px;
        margin: auto;
      }

      .logoutbtn {
        height: 50px;
        width: 100px;
        background-color: lemonchiffon;
        border-radius: 40px;
        font-size: 15px;
        border: 1px solid gainsboro;
        color: gray;
        font-weight: 600;
      }

      /* íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ */
      .listBox {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

        width: 95%;
        padding: 10px;

        background-color: #f0fff0;
      }

      .todo_list {
        background-color: #8dcd52;

        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: left;

        margin-bottom: 10px;
        width: 90%;
        min-height: 50px;

        font-size: 30px;
        border-radius: 40px;
      }

      .todo_date {
        margin-right: 20px;
        font-size: 20px;
        margin: 0 20px;
        font-weight: bold;
      }

      .todo_list > h2 {
        font-size: 20px;
        margin-right: auto;
      }

      .todo_list > input {
        width: 20px;
        height: 20px;
        margin-left: auto;
        margin-right: 20px;
        outline: 0;
        cursor: pointer;
      }

      .todo_list > button {
        margin-right: 20px;
        cursor: pointer;
        font-size: 20px;
      }

      /* íˆ¬ë‘ë¦¬ìŠ¤íŠ¸ ì™„ë£Œì‹œ íƒ€ì´í‹€ê³¼ ë‚ ì§œì— ì·¨ì†Œì„  */
      .todo_list > .todo_date_done {
        margin: 0 20px;

        text-decoration: line-through;
        font-size: 20px;
        font-weight: bold;
      }

      .listBox > .todo_list > h2.done {
        text-decoration: line-through;
      }

      .myinput {
        background-color: lemonchiffon;
        width: 1100px;
        height: 130px;
        padding: 0px 40px;

        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;

        position: fixed;
        bottom: 40px;
        /* ë°‘ì—ì„œ 10px ìœ„ì— ê³ ì •í•˜ê¸° */
        left: calc(50% - 550px);
        /* position: fixed; ì¼ë•Œ ê°€ìš´ë°ë¡œ ì˜¤ê²ŒëŠ” ì„¤ì •
       (600pxëŠ” ctaì˜ width: 1200px; ë°˜ê°’) */

        border-radius: 40px;
        border: 1px solid gainsboro;
      }

      .date {
        width: 130px;
        height: 65px;
        font-size: 16px;
        text-align: center;
        padding-left: 10px;
        border-radius: 40px;
        color: gray;
        border: 1px solid gainsboro;
      }

      .inputList {
        width: 700px;
        height: 65px;
        font-size: 20px;
        padding-left: 20px;
        border-radius: 40px;
        color: gray;
        border: 1px solid gainsboro;
      }

      .myinput > button {
        width: 150px;
        height: 65px;
        font-size: 20px;
        border-radius: 40px;
        background-color: gainsboro;
        border: 1px solid gainsboro;
        color: gray;
        font-weight: 800;
      }
    </style>

    <script>
      // ëª½ê³ DB to-do-list ë°ì´í„° í™”ë©´ì— ì¶œë ¥í•˜ê¸°
      $(document).ready(function () {
        // userInfo();
        show_todo();
        renderCurrentWeather();
        $('#listBox').empty();
      });

      // ìœ ì €ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      function userInfo() {
        fetch('/userInt')
          .then((res) => res.json())
          .then((data) => {
            rows = [data['result']];
            console.log(rows);
          });
      }

      // íˆ¬ë‘ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      function show_todo() {
        $('#title').empty();
        fetch('/todo')
          .then((res) => res.json())
          .then((data) => {
            let rows = data['result'];
            let nickname = data['nickname'];

            for (let i = 0; i < rows.length; i++) {
              const todo = rows[i].list;
              const id = rows[i]._id;
              const done = rows[i].done;
              const date = rows[i].date;
              nickname = nickname;

              let temp_html = ``;
              if (done === 0) {
                temp_html = `<div id="listBox" class="listBox">
                              <div class="todo_list">
                                <div class="todo_date">${date}</div>
                                <h2>${todo}</h2>
                                <input id=${id} class="todo_check" type="checkbox" onclick="done_todo(event)">
                                <button id=${id} onclick="delete_todo(event)" type="button" class="btn-close" aria-label="Close"></button>
                              </div>
                            </div>`;
              } else if (done === 1) {
                temp_html = `<div id="listBox" class="listBox">
                              <div class="todo_list">
                                  <div class="todo_date_done">${date}</div>
                                  <h2 class="done">${todo}</h2>
                                  <input type="checkbox" checked id=${id} onclick="cancel_todo(event)">
                                  <button id=${id} onclick="delete_todo(event)" type="button" class="btn-close" aria-label="Close"></button>
                              </div>
                            </div>`;
              }
              $('#listBox').append(temp_html);
            }

            let temp_html2 = `<div id ="title" class="title">ğŸ¸ ${nickname}ë‹˜ì˜ TO-DO-LI ğŸ¸</div>`;
            $('#title').append(temp_html2);
          });
      }

      // ëª½ê³ DBì— to-do-list ë°ì´í„° ë„£ê¸°
      function save_todo() {
        let date = $('#date').val();
        let list = $('#inputList').val();

        let formData = new FormData();
        formData.append('date_give', date);
        formData.append('list_give', list);

        fetch('/todo', { method: 'POST', body: formData })
          .then((response) => response.json())
          .then((data) => {
            alert(data['msg']);
            window.location.reload();
          });
      }

      function done_todo(event) {
        const id = event.target.getAttribute('id');
        $.ajax({
          type: 'POST',
          url: '/todo/done',
          data: { id_give: id },
          success: function (response) {
            alert(response['msg']);
            window.location.reload();
          },
        });
      }

      function cancel_todo(event) {
        const id = event.target.getAttribute('id');
        $.ajax({
          type: 'POST',
          url: '/todo/cancel',
          data: { id_give: id },
          success: function (response) {
            alert(response['msg']);
            window.location.reload();
          },
        });
      }

      function delete_todo(event) {
        const id = event.target.getAttribute('id');
        $.ajax({
          type: 'POST',
          url: '/todo/delete',
          data: { id_give: id },
          success: function (response) {
            alert(response['msg']);
            window.location.reload();
          },
        });
      }

      function renderCurrentWeather() {
        let url = `http://spartacodingclub.shop/sparta_api/weather/seoul`; // https://goweather.herokuapp.com/weather/seoul > ì—°ê²°ì´ ì•ˆë ë•Œë„ ìˆì–´ì„œ ì„œìš¸ì˜ ë‚ ì”¨ë¡œ ê°€ì ¸ì˜´
        fetch(url)
          .then((res) => res.json())
          .then((data) => {
            let Weather = data['temp'].toFixed(1); // ì†Œìˆ˜ì  í•œìë¦¬ê¹Œì§€ ê°€ì ¸ì˜´(ë°˜ì˜¬ë¦¼ë¨)
            $('#currentWeather').text(Weather + 'ë„');
          });
      }

      function logout() {
        window.location.href = '/';
      }
    </script>
  </head>

  <body>
    <div class="box">
      <!-- ë‚ ì”¨, ì œëª©, ë¡œê·¸ì•„ì›ƒ -->
      <div class="topbox">
        <div id="currentWeather" class="currentWeather"></div>
        <div id="title" class="title">ğŸ¸ {íˆ¬ë‘ë¦¬}ë‹˜ì˜ TO-DO-LIğŸ¸</div>
        <div>
          <button class="logoutbtn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <!-- ì…ë ¥ëœ ë¦¬ìŠ¤íŠ¸ë“¤(ë‚ ì§œ, ë‚´ìš©, ì²´í¬) -->
      <div id="listBox" class="listBox">
        <div class="todo_list">
          <div class="todo_date">ë‚ ì§œ</div>
          <h3>ì›¹ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ ì œì¶œí•˜ê¸°</h3>
          <button>ì²´í¬</button>
        </div>
      </div>

      <!-- ë‚ ì§œì„ íƒ, ì¸í’‹(ë‚´ìš©ì‘ì„±), ê¸°ë¡í•˜ê¸°ë²„íŠ¼ -->
      <div class="myinput">
        <input id="date" class="date" type="date" />
        <input
          id="inputList"
          class="inputList"
          type="text"
          placeholder="To Do Listë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
        />
        <button onclick="save_todo()">ê¸°ë¡í•˜ê¸°</button>
      </div>
    </div>
  </body>
</html>
